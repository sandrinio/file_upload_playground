{"version":3,"sources":["../../../../../../public/ckeditor/plugins/imagebrowser/browser/browser.js"],"names":["CkEditorImageBrowser","folders","images","ckFunctionNum","$folderSwitcher","$imagesContainer","init","$","baseHref","getQueryStringParam","h","document","head","getElementsByTagName","el","href","location","replace","initEventHandlers","loadData","initFolderSwitcher","url","onLoaded","getJSON","list","each","_idx","item","folder","thumb","image","addImage","error","jqXHR","textStatus","errorThrown","errorMessage","status","statusText","message","html","folderName","imageUrl","thumbUrl","push","$switcher","find","remove","idx","$option","data","text","appendTo","length","hide","click","renderImagesForFolder","templateHtml","imageData","$item","parseHTML","append","on","parseInt","siblings","removeClass","addClass","window","opener","CKEDITOR","tools","callFunction","close","name","regex","RegExp","result","search","match","decodeURIComponent"],"mappings":"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","file":"browser.js","sourcesContent":["var CkEditorImageBrowser = {};\n\nCkEditorImageBrowser.folders = [];\nCkEditorImageBrowser.images = {}; //folder => list of images\nCkEditorImageBrowser.ckFunctionNum = null;\n\nCkEditorImageBrowser.$folderSwitcher = null;\nCkEditorImageBrowser.$imagesContainer = null;\n\nCkEditorImageBrowser.init = function () {\n\tCkEditorImageBrowser.$folderSwitcher = $('#js-folder-switcher');\n\tCkEditorImageBrowser.$imagesContainer = $('#js-images-container');\n\n\tvar baseHref = CkEditorImageBrowser.getQueryStringParam(\"baseHref\");\n\tif (baseHref) {\n\t\tvar h = (document.head || document.getElementsByTagName(\"head\")[0]),\n\t\t\tel = h.getElementsByTagName(\"link\")[0];\n\t\tel.href = location.href.replace(/\\/[^\\/]*$/,\"/browser.css\");\n\t\t(h.getElementsByTagName(\"base\")[0]).href = baseHref;\n\t}\n\n\tCkEditorImageBrowser.ckFunctionNum = CkEditorImageBrowser.getQueryStringParam('CKEditorFuncNum');\n\n\tCkEditorImageBrowser.initEventHandlers();\n\n\tCkEditorImageBrowser.loadData(CkEditorImageBrowser.getQueryStringParam('listUrl'), function () {\n\t\tCkEditorImageBrowser.initFolderSwitcher();\n\t});\n};\n\nCkEditorImageBrowser.loadData = function (url, onLoaded) {\n\tCkEditorImageBrowser.folders = [];\n\tCkEditorImageBrowser.images = {};\n\n\t$.getJSON(url, function (list) {\n\t\t$.each(list, function (_idx, item) {\n\t\t\tif (typeof(item.folder) === 'undefined') {\n\t\t\t\titem.folder = 'Images';\n\t\t\t}\n\n\t\t\tif (typeof(item.thumb) === 'undefined') {\n\t\t\t\titem.thumb = item.image;\n\t\t\t}\n\n\t\t\tCkEditorImageBrowser.addImage(item.folder, item.image, item.thumb);\n\t\t});\n\n\t\tonLoaded();\n\t}).error(function(jqXHR, textStatus, errorThrown) {\n\t\tvar errorMessage;\n\t\tif (jqXHR.status < 200 || jqXHR.status >= 400) {\n\t\t\terrorMessage = 'HTTP Status: ' + jqXHR.status + '/' + jqXHR.statusText + ': \"<strong style=\"color: red;\">' + url + '</strong>\"';\n\t\t} else if (textStatus === 'parsererror') {\n\t\t\terrorMessage = textStatus + ': invalid JSON file: \"<strong style=\"color: red;\">' + url + '</strong>\": ' + errorThrown.message;\n\t\t} else {\n\t\t\terrorMessage = textStatus + ' / ' + jqXHR.statusText + ' / ' + errorThrown.message;\n\t\t}\n\t\tCkEditorImageBrowser.$imagesContainer.html(errorMessage);\n    });\n};\n\nCkEditorImageBrowser.addImage = function (folderName, imageUrl, thumbUrl) {\n\tif (typeof(CkEditorImageBrowser.images[folderName]) === 'undefined') {\n\t\tCkEditorImageBrowser.folders.push(folderName);\n\t\tCkEditorImageBrowser.images[folderName] = [];\n\t}\n\n\tCkEditorImageBrowser.images[folderName].push({\n\t\t\"imageUrl\": imageUrl,\n\t\t\"thumbUrl\": thumbUrl\n\t});\n};\n\nCkEditorImageBrowser.initFolderSwitcher = function () {\n\tvar $switcher = CkEditorImageBrowser.$folderSwitcher;\n\n\t$switcher.find('li').remove();\n\n\t$.each(CkEditorImageBrowser.folders, function (idx, folderName) {\n\t\tvar $option = $('<li></li>').data('idx', idx).text(folderName);\n\t\t$option.appendTo($switcher);\n\t});\n\n\n\tif (CkEditorImageBrowser.folders.length === 0) {\n\t\t$switcher.remove();\n\t\tCkEditorImageBrowser.$imagesContainer.text('No images.');\n\t} else {\n\t\tif (CkEditorImageBrowser.folders.length === 1) {\n\t\t\t$switcher.hide();\n\t\t}\n\n\t\t$switcher.find('li:first').click();\n\t}\n};\n\nCkEditorImageBrowser.renderImagesForFolder = function (folderName) {\n\tvar images = CkEditorImageBrowser.images[folderName],\n\t\ttemplateHtml = $('#js-template-image').html();\n\n\tCkEditorImageBrowser.$imagesContainer.html('');\n\n\t$.each(images, function (_idx, imageData) {\n\t\tvar html = templateHtml;\n\t\thtml = html.replace('%imageUrl%', imageData.imageUrl);\n\t\thtml = html.replace('%thumbUrl%', imageData.thumbUrl);\n\n\t\tvar $item = $($.parseHTML(html));\n\n\t\tCkEditorImageBrowser.$imagesContainer.append($item);\n\t});\n};\n\nCkEditorImageBrowser.initEventHandlers = function () {\n\t$(document).on('click', '#js-folder-switcher li', function () {\n\t\tvar idx = parseInt($(this).data('idx'), 10),\n\t\t\tfolderName = CkEditorImageBrowser.folders[idx];\n\n\t\t$(this).siblings('li').removeClass('active');\n\t\t$(this).addClass('active');\n\n\t\tCkEditorImageBrowser.renderImagesForFolder(folderName);\n\t});\n\n\t$(document).on('click', '.js-image-link', function () {\n\t\twindow.opener.CKEDITOR.tools.callFunction(CkEditorImageBrowser.ckFunctionNum, $(this).data('url'));\n\t\twindow.close();\n\t});\n};\n\nCkEditorImageBrowser.getQueryStringParam = function (name) {\n\tvar regex = new RegExp('[?&]' + name + '=([^&]*)'),\n\t\tresult = window.location.search.match(regex);\n\n\treturn (result && result.length > 1 ? decodeURIComponent(result[1]) : null);\n};\n"]}