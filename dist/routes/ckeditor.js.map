{"version":3,"sources":["../../routes/ckeditor.js"],"names":["express","require","router","Router","multer","Posts","path","storage","diskStorage","destination","req","file","cb","filename","tempName","Date","now","originalname","imageName","imgName","upload","get","res","render","post","any","html","query","CKEditorFuncNum","send","next","data","body","content","responseTxt","title","titleErr","editor","editorErr","pContent","author","firstname","lastname","pic","create","err","postData","console","log","json","module","exports"],"mappings":";;AAAA;;;AAGA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,SAASF,QAAQG,MAAR,EAAf;AACA,IAAMC,SAAUH,QAAQ,QAAR,CAAhB;AACA,IAAMI,QAAQJ,QAAQ,iBAAR,CAAd;AACA,IAAMK,OAAOL,QAAQ,MAAR,CAAb;;AAGA,IAAMM,UAAUH,OAAOI,WAAP,CAAmB;AAChCC,gBAAa,qBAAUC,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AACnCA,SAAG,IAAH,EAAS,+BAAT;AACF,IAH+B;AAIhCC,aAAU,kBAAUH,GAAV,EAAeC,IAAf,EAAqBC,EAArB,EAAyB;AAChC,UAAIE,WAAWC,KAAKC,GAAL,KAAa,GAAb,GAAmBL,KAAKM,YAAvC;AACAL,SAAG,IAAH,EAASE,QAAT;AACAI,gBAAUC,OAAV,GAAoBL,QAApB;AACF;AAR+B,CAAnB,CAAhB;AAUA,IAAMM,SAAShB,OAAO,EAAEG,SAASA,OAAX,EAAP,CAAf;;AAEA,IAAIW,YAAY,EAAhB;;AAEAhB,OAAOmB,GAAP,CAAW,WAAX,EAAwB,UAACX,GAAD,EAAMY,GAAN,EAAc;AACnCA,OAAIC,MAAJ,CAAW,UAAX;AACF,CAFD;;AAIArB,OAAOsB,IAAP,CAAY,YAAZ,EAA0BJ,OAAOK,GAAP,CAAW,SAAX,CAA1B,EAAiD,UAACf,GAAD,EAAMY,GAAN,EAAc;;AAE5D;;AAEA;;AAEMI,UAAO,EAAP;AACAA,WAAQ,iCAAR;AACAA,WAAQ,uBAAuBhB,IAAIiB,KAAJ,CAAUC,eAAjC,GAAmD,GAA3D;AACAF,WAAQ,gDAAgDR,UAAUC,OAA1D,GAAoE,KAA5E;AACAO,WAAQ,mDAAR;AACAA,WAAQ,EAAR;AACAA,WAAQ,uEAAR;AACAA,WAAQ,WAAR;;AAEAJ,OAAIO,IAAJ,CAASH,IAAT;AACR,CAhBD;;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAxB,OAAOsB,IAAP,CAAY,YAAZ,EAA0B,UAACd,GAAD,EAAMY,GAAN,EAAWQ,IAAX,EAAoB;AAC3C,OAAIC,OAAOrB,IAAIsB,IAAJ,CAASC,OAApB;AACA,OAAIC,cAAc,EAAlB;AACA,OAAG,CAACH,KAAKI,KAAT,EAAe;AACb,aAAOD,YAAYE,QAAZ,GAAuB,mBAA9B;AACD;AACD,OAAG,CAACL,KAAKM,MAAT,EAAgB;AACd,aAAOH,YAAYI,SAAZ,GAAwB,oBAA/B;AACD;AACD,OAAGP,KAAKI,KAAL,IAAcJ,KAAKM,MAAtB,EAA6B;AAC1B,UAAIE,WAAW,EAAf;AACAA,eAASJ,KAAT,GAAiBJ,KAAKI,KAAtB;AACAI,eAASN,OAAT,GAAmBF,KAAKM,MAAxB;AACAE,eAASC,MAAT,GAAkB;AACfC,oBAAW,QADI;AAEfC,mBAAU,SAFK;AAGfC,cAAK;AAHU,OAAlB;AAKAtC,YAAMuC,MAAN,CAAaL,QAAb,EAAuB,UAAUM,GAAV,EAAeC,QAAf,EAAyB;AAC7C,aAAGD,GAAH,EAAO;AACL,mBAAOE,QAAQC,GAAR,CAAYH,GAAZ,CAAP;AACD;AACDvB,aAAI2B,IAAJ,CAASf,WAAT;AACF,OALD;AAMF;AACH,CAzBD;;AA6BAgB,OAAOC,OAAP,GAAiBjD,MAAjB","file":"ckeditor.js","sourcesContent":["/**\n * Created by Sandro on 8/8/17.\n */\nconst express = require('express');\nconst router = express.Router();\nconst multer  = require('multer');\nconst Posts = require('../models/posts')\nconst path = require('path');\n\n\nconst storage = multer.diskStorage({\n   destination: function (req, file, cb) {\n      cb(null, 'public/uploads/basic_uploads/')\n   },\n   filename: function (req, file, cb) {\n      let tempName = Date.now() + \"-\" + file.originalname;\n      cb(null, tempName);\n      imageName.imgName = tempName;\n   }\n});\nconst upload = multer({ storage: storage });\n\nlet imageName = {};\n\nrouter.get('/ckeditor', (req, res) => {\n   res.render('ckeditor')\n});\n\nrouter.post('/ck_upload', upload.any('editor1'), (req, res) => {\n\n   // console.log(imageName.imgName)\n\n   // res.send('/upload/basic_uploads/' + imageName.imgName)\n\n         html = \"\";\n         html += \"<script type='text/javascript'>\";\n         html += \"    var funcNum = \" + req.query.CKEditorFuncNum + \";\";\n         html += \"    var url     = \\\"/uploads/basic_uploads/\" + imageName.imgName + \"\\\";\";\n         html += \"    var message = \\\"Uploaded file successfully\\\";\";\n         html += \"\";\n         html += \"    window.parent.CKEDITOR.tools.callFunction(funcNum, url, message);\";\n         html += \"</script>\";\n\n         res.send(html);\n});\n\n//             SEED DATA\n// router.post('/save_post', (req, res, next) => {\n//    let data = req.body.content;\n//    let responseTxt = {};\n//    if(!data.title){\n//      return responseTxt.titleErr = \"შეიყვანეთ სათაური\"\n//    }\n//    if(!data.editor){\n//      return responseTxt.editorErr = \"შეიყვანეთ კონტენტი\"\n//    }\n//    if(data.title && data.editor){\n//       let numb = 1;\n//       for(let i = 0; i < 50; i++){\n//          numb += 1;\n//          let postContent = {};\n//          postContent.title = data.title;\n//          postContent.content = data.editor;\n//          postContent.author = {\n//             firstname: 'Sandro' + \" \" + numb,\n//             lastname: 'Suladze',\n//             pic: '/uploads/basic_uploads/1502279242741-10205955424663795.jpg'\n//          };\n//\n//          Posts.create(postContent, function (err, postData){\n//          });\n//       }\n//       let pContent = {};\n//       pContent.title = data.title;\n//       pContent.content = data.editor;\n//       pContent.author = {\n//          firstname: 'Sandro',\n//          lastname: 'Suladze',\n//          pic: '/uploads/basic_uploads/1502279242741-10205955424663795.jpg'\n//       };\n//       Posts.create(pContent, function (err, postData) {\n//          if(err){\n//            return console.log(err)\n//          }\n//          res.json(responseTxt)\n//       });\n//    }\n// });\nrouter.post('/save_post', (req, res, next) => {\n   let data = req.body.content;\n   let responseTxt = {};\n   if(!data.title){\n     return responseTxt.titleErr = \"შეიყვანეთ სათაური\"\n   }\n   if(!data.editor){\n     return responseTxt.editorErr = \"შეიყვანეთ კონტენტი\"\n   }\n   if(data.title && data.editor){\n      let pContent = {};\n      pContent.title = data.title;\n      pContent.content = data.editor;\n      pContent.author = {\n         firstname: 'Sandro',\n         lastname: 'Suladze',\n         pic: '/uploads/basic_uploads/1502279242741-10205955424663795.jpg'\n      };\n      Posts.create(pContent, function (err, postData) {\n         if(err){\n           return console.log(err)\n         }\n         res.json(responseTxt)\n      });\n   }\n});\n\n\n\nmodule.exports = router;"]}